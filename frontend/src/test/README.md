# Dashboard 组件测试文档

本文档详细说明 Dashboard 页面组件的测试方法、覆盖范围和最佳实践。

## 测试方法概述

我们使用以下技术栈进行前端测试：

- **React Testing Library** - 用于组件渲染、查询和用户交互测试
- **Jest** - 测试运行器和断言库
- **Mock 技术** - 模拟外部依赖（如 API 请求和子组件）

## 测试文件结构

- `dashboard.test.js` - Dashboard 组件的主要测试文件

## 测试覆盖范围

### 1. 初始加载状态测试

- 验证组件在数据加载过程中显示加载提示
- 确保加载状态正确渲染

### 2. 数据加载成功场景

- 验证 KPI 卡片正确渲染
- 确认图表组件接收并处理数据
- 验证主题热度表格显示正确数据
- 检查各个组件之间的集成

### 3. 异常情况处理

- API 请求失败时的错误处理
- 空数据响应时的空状态显示
- 边界条件测试

### 4. 用户交互测试

- 过滤器变更处理
- 主题展开/折叠功能
- 洞察模态框的打开、显示和关闭
- 表格中悬停状态和提示功能

### 5. 组件交互与集成

- 测试组件与子组件的交互
- 验证状态更新后的重新渲染
- 测试事件处理函数的正确调用

## Mock 策略

为了隔离测试并确保测试的可靠性，我们对以下依赖进行了模拟：

### API 请求模拟

使用 Jest mock 模拟 axios 请求，提供预设的响应数据：

```javascript
jest.mock("axios");

// 在测试中配置模拟响应
axios.get.mockImplementation((url) => {
  if (url.includes("/api/kpis")) return Promise.resolve({ data: mockKpis });
  // 其他 API 端点的模拟
});
```

### 子组件模拟

为避免测试依赖于子组件的实现细节，我们模拟了以下子组件：

- `FilterPanel` - 简化为带按钮的组件，用于触发过滤器变更
- `KPICard` - 保留基本结构，方便测试渲染
- `EnhancedChart` - 简化版本，验证是否接收正确的 props

### 第三方库模拟

Recharts 图表库组件也进行了模拟，以简化测试并避免 DOM 复杂性。

## 测试最佳实践

1. **使用 `act` 包装异步状态更新**

   - 确保所有状态更新都在 React.act 中进行，避免警告
   - 对于异步操作，使用 async/await 配合 act

2. **使用数据测试 ID**

   - 为关键元素添加 `data-testid` 以提高测试的稳定性
   - 避免依赖 CSS 类名或复杂的 DOM 结构

3. **验证完整的用户流程**

   - 测试从初始加载到用户交互的完整流程
   - 模拟真实用户操作序列

4. **覆盖边缘情况**
   - 空数据、错误响应、网络延迟等
   - 确保组件在各种条件下都能正常工作

## 运行测试

### 运行所有测试

```bash
npm test
```

### 运行特定测试文件

```bash
npm test dashboard.test.js
```

### 生成测试覆盖率报告

```bash
npm test -- --coverage
```

## 测试维护指南

1. **随着功能更新调整测试**

   - 当 Dashboard 组件功能发生变化时，及时更新相关测试
   - 确保新功能有相应的测试覆盖

2. **定期运行测试**

   - 在开发过程中定期运行测试，确保代码变更不会破坏现有功能
   - 在 CI/CD 流程中集成测试运行

3. **扩展测试覆盖**
   - 随着组件的扩展，持续增加新的测试用例
   - 关注用户反馈和 bug 修复，为修复的问题添加测试

通过这些测试方法和实践，我们确保 Dashboard 组件的质量、可靠性和可维护性，为用户提供稳定的使用体验。
